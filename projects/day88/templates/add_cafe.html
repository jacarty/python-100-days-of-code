{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<section class="add-cafe-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2><i class="fas fa-plus-circle"></i> Add New Cafe</h2>
                <p>Share a great cafe with the community</p>
            </div>
        </div>
    </div>
</section>

<!-- Form Section -->
<section class="add-cafe-section">
    <div class="container">
        <div class="form-container">
            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                <h4>Success!</h4>
                <p>Your cafe has been added successfully.</p>
            </div>

            <div class="form-card">
                <form id="addCafeForm" method="POST" action="{{ url_for('post_new_cafe') }}">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle"></i> Basic Information
                        </h3>

                        <div class="form-group">
                            <label for="name">Cafe Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required
                                placeholder="e.g., The Coffee House">
                        </div>

                        <div class="form-group">
                            <label for="location">Location *</label>
                            <input type="text" class="form-control" id="location" name="location" required
                                placeholder="e.g., Shoreditch, London">
                            <small class="form-text">Enter the area or neighborhood</small>
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-link"></i> Links
                        </h3>

                        <div class="form-group">
                            <label for="map_url">Google Maps URL *</label>
                            <input type="url" class="form-control" id="map_url" name="map_url" required
                                placeholder="https://g.page/...">
                            <small class="form-text">Paste the Google Maps link</small>
                        </div>

                        <div class="form-group">
                            <label for="img_url">Image URL *</label>
                            <input type="url" class="form-control" id="img_url" name="img_url" required
                                placeholder="https://example.com/image.jpg">
                            <small class="form-text">Link to a photo of the cafe</small>
                        </div>
                    </div>

                    <!-- Amenities -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-check-square"></i> Amenities
                        </h3>

                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="wifi" name="wifi" value="1">
                                <label for="wifi">
                                    <i class="fas fa-wifi"></i> WiFi Available
                                </label>
                            </div>

                            <div class="checkbox-item">
                                <input type="checkbox" id="sockets" name="sockets" value="1">
                                <label for="sockets">
                                    <i class="fas fa-plug"></i> Power Sockets
                                </label>
                            </div>

                            <div class="checkbox-item">
                                <input type="checkbox" id="toilet" name="toilet" value="1">
                                <label for="toilet">
                                    <i class="fas fa-restroom"></i> Restroom
                                </label>
                            </div>

                            <div class="checkbox-item">
                                <input type="checkbox" id="calls" name="calls" value="1">
                                <label for="calls">
                                    <i class="fas fa-phone-alt"></i> Calls Allowed
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Details -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-clipboard-list"></i> Additional Details
                        </h3>

                        <div class="form-group">
                            <label for="seats">Number of Seats *</label>
                            <input type="text" class="form-control" id="seats" name="seats" required
                                placeholder="e.g., 20-30 or 50+">
                            <small class="form-text">Approximate seating capacity</small>
                        </div>

                        <div class="form-group">
                            <label for="coffee_price">Coffee Price</label>
                            <input type="text" class="form-control" id="coffee_price" name="coffee_price"
                                placeholder="e.g., Â£3.50">
                            <small class="form-text">Average price for a regular coffee (optional)</small>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="form-section">
                        <button type="submit" class="btn btn-primary btn-submit">
                            <i class="fas fa-plus-circle"></i> Add Cafe
                        </button>
                        <a href="{{ url_for('cafes') }}" class="btn btn-cancel">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Handle form submission
    document.getElementById('addCafeForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(this);

        fetch('{{ url_for("post_new_cafe") }}', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.response && data.response.success) {
                    // Show success message
                    document.getElementById('successMessage').classList.add('show');

                    // Reset form
                    this.reset();

                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = '{{ url_for("cafes") }}';
                    }, 2000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error adding the cafe. Please try again.');
            });
    });
</script>
{% endblock %}